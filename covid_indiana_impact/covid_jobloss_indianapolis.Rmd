---
title: "Covid job losses in Indianapolis"
author: "Jacob Toner Gosselin"
date: "10/21/2020"
output: html_document
---

```{r setup, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(readxl)
library(readr)
library(ggmap)
library(ggplot2)
library(tigris)
library(leaflet)
```

This was a small project I put together while I was an AmeriCorps VISTA assigned to the IndyEast Promise Zone. We were interested in projecting job loss in our neighborhood (the Eastside of Indianapolis) compared to Indy at large. The Urban Institute put together [estimates](https://www.urban.org/features/where-low-income-jobs-are-being-lost-covid-19) of low income jobs lost by Census tract. Their methodology can be found [here](https://www.urban.org/sites/default/files/2020/06/05/where_low-income_jobs_are_being_lost_to_covid-19_technical_appendix_1_0.pdf); the main point is they used data from the Bureau of Labor Statistics Current Employment Statistics program, which measures net change in employment from February 2020 to the most recent month of data (currently September 2020, they're updating as data is released monthly). I'm subsetting data and then showing interactive maps of Indianapolis, and Indiana, displaying low income job loss by Census tract. 

```{r Reading in the Data, subsetting by district, county, and state, echo=FALSE, results="hide", message=FALSE}
full <- read.csv("https://ui-lodes-job-change-public.s3.amazonaws.com/job_loss_by_tract.csv")
state <- subset(full, state_name=="Indiana")
county <- subset(state, county_name=="Marion County")
mobility_district <- subset(county, GEOID=="18097351700" | GEOID== "18097352600" | GEOID=="18097352700" | GEOID=="18097352800" | GEOID=="18097354400" | GEOID=="18097354500" | GEOID=="18097354700" | GEOID=="18097354800" | GEOID=="18097354900" | GEOID=="18097355000" | GEOID=="18097355100" | GEOID=="18097355600" | GEOID=="18097355700" )
state_tracts <- tracts(state=18)
county_tracts <- tracts(state=18,county=97)
```

## Mapping

Below are interactive maps showing projected low income job loss rate by Census tract in Marion county, and in the state at large.

### Indiana Map
```{r Mapping1, echo=FALSE, warning=FALSE}
county_merged <- sp::merge(county_tracts, county, "GEOID")
state_merged <- sp::merge(state_tracts, state, "GEOID")
state_merged <- subset(state_merged, state_merged$low_income_worker_job_loss_rate != "NA")

popup <- paste0("GEOID: ", state_merged$GEOID, "<br>", "Percent of Low Income Jobs Lost: ", state_merged$low_income_worker_job_loss_rate)
pal <- colorNumeric(
  palette = "YlGnBu",
  domain = state_merged$low_income_worker_job_loss_rate
)

state_map<-leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = state_merged, 
              fillColor = ~pal(low_income_worker_job_loss_rate), 
              color = "#b2aeae", # you need to use hex colors
              fillOpacity = 0.7, 
              weight = 1, 
              smoothFactor = 0.2,
              popup = popup) %>%
  addLegend(pal=pal,
            values = state_merged$low_income_worker_job_loss_rate, 
            position = "bottomright", 
            title = "Percent of Low Income Jobs Lost") 

state_map
```

### Marion County (Indianapolis) Map
```{r Mapping2, echo=FALSE, warning=FALSE}
popup <- paste0("GEOID: ", county_merged$GEOID, "<br>", "Percent of Low Income Jobs Lost: ", county_merged$low_income_worker_job_loss_rate)
pal <- colorNumeric(
  palette = "YlGnBu",
  domain = county_merged$low_income_worker_job_loss_rate
)

county_map<-leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = county_merged, 
              fillColor = ~pal(low_income_worker_job_loss_rate), 
              color = "#b2aeae", # you need to use hex colors
              fillOpacity = 0.7, 
              weight = 1, 
              smoothFactor = 0.2,
              popup = popup) %>%
  addLegend(pal = pal, 
            values = round(county_merged$low_income_worker_job_loss_rate,2), 
            position = "bottomright", 
            title = "Percent of Low Income Jobs Lost")

county_map
```
